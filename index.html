<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kaspa ($KAS) Risk Metric Heatmap</title>
  <!-- Use the latest Plotly.js version -->
  <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #fff; /* White background */
      color: #000; /* Black text */
    }
    h1 {
      text-align: center;
      color: #000; /* Black title */
    }
    #heatmap {
      width: 100%;
      height: 600px;
    }
    .time-frame-buttons {
      text-align: center;
      margin-bottom: 20px;
    }
    .time-frame-buttons button {
      margin: 5px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }
    .description {
      max-width: 800px;
      margin: 0 auto 20px;
      line-height: 1.6;
    }
    .description h2 {
      color: #333;
    }
    .description ul {
      margin: 10px 0;
      padding-left: 20px;
    }
    .description ul li {
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <h1>Kaspa ($KAS) Risk Metric Heatmap</h1>

  <!-- Description Section -->
  <div class="description">
    <h2>How the Kaspa Risk Metric Heatmap Works</h2>
    <p>
      A Kaspa risk metric heatmap combines several key metrics to gauge the overall risk level associated with Kaspa's price, volatility, and market behavior. Here's a breakdown of how it can be calculated:
    </p>
    <ul>
      <li>
        <strong>Volatility (Price Fluctuations):</strong> The heatmap tracks historical price volatility, such as the standard deviation of Kaspa's price over a given period (e.g., 30 days). Higher volatility indicates higher risk.
      </li>
      <li>
        <strong>Market Sentiment:</strong> Market sentiment analysis uses metrics like the Fear & Greed Index, on-chain data (such as transaction volume or wallet behavior), or social media sentiment to assess investor psychology. A high level of fear may indicate increased risk, while greed can suggest overconfidence.
      </li>
      <li>
        <strong>Network Activity:</strong> Metrics like transaction counts, active addresses, and network hash rate provide insight into how active and secure the Kaspa network is. A sudden decrease in network activity or hash rate can signal potential risks.
      </li>
      <li>
        <strong>Risk/Reward Ratio:</strong> This is the ratio of potential return to risk, considering price momentum, on-chain metrics, and market volatility. A favorable ratio suggests lower risk.
      </li>
      <li>
        <strong>Technical Indicators:</strong> Tools like moving averages (e.g., 50-day or 200-day MA) and Relative Strength Index (RSI) are commonly used to assess overbought or oversold conditions. These indicators help signal potential reversal points or market exhaustion, indicating higher or lower risk.
      </li>
      <li>
        <strong>On-Chain Metrics:</strong> Metrics like the NVT (Network Value to Transaction) ratio, which compares the network value to transaction volume, can be included to identify if Kaspa is overvalued relative to its transactional usage.
      </li>
    </ul>
    <p>
      The heatmap assigns a color code based on the values of these metrics, where typically:
    </p>
    <ul>
      <li><span style="color: green;">Green</span> signals low risk</li>
      <li><span style="color: yellow;">Yellow</span> signals moderate risk</li>
      <li><span style="color: red;">Red</span> signals high risk</li>
    </ul>
    <p>
      By analyzing these combined indicators, the heatmap provides a quick visual representation of Kaspaâ€™s risk level at any given moment.
    </p>
  </div>

  <!-- Time Frame Buttons -->
  <div class="time-frame-buttons">
    <button onclick="updateChart('1w')">1 Week</button>
    <button onclick="updateChart('1m')">1 Month</button>
    <button onclick="updateChart('3m')">3 Months</button>
    <button onclick="updateChart('1y')">1 Year</button>
    <button onclick="updateChart('all')">All History</button>
  </div>

  <!-- Heatmap Chart -->
  <div id="heatmap"></div>

  <script>
    let currentTimeFrame = 'all'; // Default to entire history

    // Fetch historical data from your backend
    async function fetchData(timeFrame) {
      try {
        const response = await fetch(`https://kas-risk-app.onrender.com/data/historical?timeFrame=${timeFrame}`);
        if (!response.ok) {
          throw new Error(`Server error: ${response.status}`);
        }
        const data = await response.json();
        if (data.error) {
          throw new Error(data.error);
        }
        return data;
      } catch (error) {
        console.error('Error fetching data:', error);
        alert('Failed to fetch data. Please try again later.');
        return null;
      }
    }

    // Render the heatmap using Plotly
    function renderHeatmap(data) {
      const heatmapData = {
        x: data.dates, // Dates on the x-axis
        y: data.prices, // Prices on the y-axis
        mode: 'markers', // Display as individual dots
        marker: {
          size: 10,
          color: data.risks, // Risk values determine color
          colorscale: [
            [0, 'blue'],   // Low risk (buy)
            [0.5, 'green'], // Medium risk
            [1, 'red']     // High risk (sell)
          ],
          colorbar: {
            title: 'Risk Level',
            titleside: 'right',
            titlefont: { color: '#000' }, // Black text for colorbar title
            tickfont: { color: '#000' }, // Black text for colorbar ticks
          },
        },
        type: 'scatter', // Scatter plot for dots
      };

      const layout = {
        title: 'Kaspa Risk Metrics Over Time',
        titlefont: { color: '#000' }, // Black text for chart title
        xaxis: {
          title: 'Date',
          titlefont: { color: '#000' }, // Black text for x-axis title
          tickfont: { color: '#000' }, // Black text for x-axis ticks
          gridcolor: '#ddd', // Light gray grid lines
          type: 'date', // Ensure dates are displayed correctly
          tickformat: '%b %Y', // Format as "Month Year" (e.g., May 2024)
        },
        yaxis: {
          title: 'Price (USD)',
          titlefont: { color: '#000' }, // Black text for y-axis title
          tickfont: { color: '#000' }, // Black text for y-axis ticks
          gridcolor: '#ddd', // Light gray grid lines
        },
        plot_bgcolor: '#fff', // White background for the plot area
        paper_bgcolor: '#fff', // White background for the chart area
        width: 1200,
        height: 600,
      };

      Plotly.newPlot('heatmap', [heatmapData], layout);
    }

    // Update the chart with new data
    async function updateChart(timeFrame) {
      currentTimeFrame = timeFrame || currentTimeFrame;
      const data = await fetchData(currentTimeFrame);
      if (data) {
        renderHeatmap(data);
      }
    }

    // Initial load
    updateChart();
  </script>
</body>
</html>
